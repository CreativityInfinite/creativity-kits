/* Global decorative animations and effects with theme presets */
/* Theme variables: control neon lines, stars, ring, sweep colors and intensities */
:root {
  --neon-c1: rgba(99, 102, 241, 0.18); /* indigo */
  --neon-c2: rgba(56, 189, 248, 0.16); /* sky */
  --neon-c3: rgba(168, 85, 247, 0.18); /* fuchsia */
  --neon-line: rgba(94, 234, 212, 0.25); /* teal glow */
  --ring-a: rgba(56, 189, 248, 0.55);
  --ring-b: rgba(168, 85, 247, 0.55);
  --sweep-a: rgba(56, 189, 248, 0.06);
  --sweep-b: rgba(99, 102, 241, 0.18);
}

/* Theme presets */
html[data-theme='cool-blue'] {
  --neon-c1: rgba(14, 165, 233, 0.18);
  --neon-c2: rgba(59, 130, 246, 0.18);
  --neon-c3: rgba(125, 211, 252, 0.18);
  --neon-line: rgba(56, 189, 248, 0.28);
  --ring-a: rgba(59, 130, 246, 0.55);
  --ring-b: rgba(14, 165, 233, 0.55);
  --sweep-a: rgba(59, 130, 246, 0.08);
  --sweep-b: rgba(14, 165, 233, 0.18);
}
html[data-theme='cyber-purple'] {
  --neon-c1: rgba(168, 85, 247, 0.22);
  --neon-c2: rgba(236, 72, 153, 0.18);
  --neon-c3: rgba(147, 51, 234, 0.2);
  --neon-line: rgba(217, 70, 239, 0.28);
  --ring-a: rgba(217, 70, 239, 0.6);
  --ring-b: rgba(147, 51, 234, 0.55);
  --sweep-a: rgba(217, 70, 239, 0.08);
  --sweep-b: rgba(147, 51, 234, 0.22);
}
html[data-theme='prism-laser'] {
  --neon-c1: rgba(34, 197, 94, 0.22);
  --neon-c2: rgba(59, 130, 246, 0.18);
  --neon-c3: rgba(244, 63, 94, 0.2);
  --neon-line: rgba(34, 197, 94, 0.28);
  --ring-a: rgba(34, 197, 94, 0.55);
  --ring-b: rgba(244, 63, 94, 0.55);
  --sweep-a: rgba(34, 197, 94, 0.08);
  --sweep-b: rgba(244, 63, 94, 0.22);
}

/* hello bouncing */
@keyframes hello-bounce {
  0%,
  100% {
    transform: translateY(0px) scale(1.2);
  }
  25% {
    transform: translateY(-10px) scale(1.3);
  }
  50% {
    transform: translateY(0px) scale(1.2);
  }
  75% {
    transform: translateY(-6px) scale(1.25);
  }
}
.animation-hello {
  display: inline-block;
  font-size: 1.5em;
  animation: hello-bounce 5s ease-in-out infinite;
  transform-origin: center bottom;
}

/* float blobs */
@keyframes floatY {
  0% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-12px);
  }
  100% {
    transform: translateY(0);
  }
}
@keyframes floatX {
  0% {
    transform: translateX(0);
  }
  50% {
    transform: translateX(16px);
  }
  100% {
    transform: translateX(0);
  }
}
.animate-float-slow {
  animation: floatY 18s ease-in-out infinite alternate, floatX 22s ease-in-out infinite alternate;
  will-change: transform;
}

/* Neon grid */
.neon-grid {
  background-image: linear-gradient(to right, var(--neon-line) 1px, transparent 1px), linear-gradient(to bottom, var(--neon-line) 1px, transparent 1px);
  background-size: 28px 28px, 28px 28px;
  mask-image: radial-gradient(ellipse at 30% 10%, rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0));
  animation: grid-drift 18s linear infinite;
  opacity: 0.5;
}
@keyframes grid-drift {
  0% {
    background-position: 0 0, 0 0;
  }
  100% {
    background-position: 140px 140px, 140px 140px;
  }
}

/* Stars */
.stars {
  background-image: radial-gradient(2px 2px at 10% 20%, var(--neon-c2), transparent), radial-gradient(1.5px 1.5px at 70% 30%, var(--neon-c1), transparent),
    radial-gradient(2px 2px at 40% 80%, var(--neon-c3), transparent), radial-gradient(1.5px 1.5px at 85% 60%, rgba(255, 255, 255, 0.25), transparent);
  filter: blur(0.2px);
  animation: stars-twinkle 3.6s ease-in-out infinite alternate;
  opacity: 0.6;
}
@keyframes stars-twinkle {
  0% {
    opacity: 0.35;
    transform: translateY(0);
  }
  50% {
    opacity: 0.7;
    transform: translateY(-2px);
  }
  100% {
    opacity: 0.45;
    transform: translateY(0);
  }
}

/* Rotating ring */
.rotating-ring {
  --ring: conic-gradient(from 0deg, transparent 0deg, rgba(56, 189, 248, 0) 160deg, var(--ring-a) 200deg, var(--ring-b) 260deg, transparent 360deg);
  background: var(--ring);
  border-radius: 9999px;
  filter: blur(8px) saturate(1.15);
  mix-blend-mode: screen;
  animation: ring-rotate 12s linear infinite;
}
@keyframes ring-rotate {
  to {
    transform: rotate(360deg);
  }
}

/* Neon sweep */
.neon-sweep {
  background: linear-gradient(90deg, transparent 0%, var(--sweep-a) 30%, var(--sweep-b) 50%, var(--sweep-a) 70%, transparent 100%);
  filter: blur(6px) saturate(1.1);
  mix-blend-mode: screen;
  animation: sweep 6s ease-in-out infinite;
}
@keyframes sweep {
  0% {
    transform: translateX(0);
    opacity: 0;
  }
  10% {
    opacity: 0.6;
  }
  50% {
    transform: translateX(140%);
    opacity: 0.4;
  }
  90% {
    opacity: 0;
  }
  100% {
    transform: translateX(140%);
    opacity: 0;
  }
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  .animation-hello,
  .animate-float-slow,
  .neon-grid,
  .stars,
  .rotating-ring,
  .neon-sweep {
    animation: none !important;
  }
}

/* ---------------- Fancy theme switch: View Transition + Fallback ---------------- */

/* 背景色变量（用于回退遮罩） */
:root {
  --bg-light: #ffffff;
  --bg-dark: #0a0a0a;
}

/* View Transitions: 以 data-theme-switch 控制方向与起点 */
:root::view-transition-old(root),
:root::view-transition-new(root) {
  animation: none;
}

/* 切到暗色：新状态从左下角圆形扩散 */
:root[data-theme-switch='to-dark']::view-transition-new(root) {
  clip-path: circle(0% at 0% 100%);
  animation: vt-reveal-from-left-bottom 600ms cubic-bezier(0.22, 0.61, 0.36, 1) forwards;
}

/* 切到亮色：新状态从右上角圆形扩散 */
:root[data-theme-switch='to-light']::view-transition-new(root) {
  clip-path: circle(0% at 100% 0%);
  animation: vt-reveal-from-right-top 600ms cubic-bezier(0.22, 0.61, 0.36, 1) forwards;
}

@keyframes vt-reveal-from-left-bottom {
  from {
    clip-path: circle(0% at 0% 100%);
  }
  to {
    clip-path: circle(150% at 0% 100%);
  }
}

@keyframes vt-reveal-from-right-top {
  from {
    clip-path: circle(0% at 100% 0%);
  }
  to {
    clip-path: circle(150% at 100% 0%);
  }
}

/* 回退遮罩：一个固定定位的全屏层，使用目标主题背景色并径向扩散 */
.theme-wipe-overlay {
  position: fixed;
  inset: 0;
  z-index: 9999;
  pointer-events: none;
  will-change: clip-path, transform, opacity;
  /* 以 CSS 变量定义起点，便于 JS 指定 */
  --wipe-cx: 0%;
  --wipe-cy: 100%;
  clip-path: circle(0% at var(--wipe-cx) var(--wipe-cy));
}

@keyframes wipe-grow {
  from {
    clip-path: circle(0% at var(--wipe-cx) var(--wipe-cy));
  }
  to {
    clip-path: circle(160% at var(--wipe-cx) var(--wipe-cy));
  }
}

/* 减少动效时禁用所有主题过渡 */
@media (prefers-reduced-motion: reduce) {
  :root::view-transition-old(root),
  :root::view-transition-new(root) {
    animation: none !important;
  }
  .theme-wipe-overlay {
    display: none !important;
    animation: none !important;
  }
}
